- title("Invoices")
.row
  %h1.span5 #{@invoiceable.name} Invoices
  .model_actions
    = link_to 'New Invoice', [:new, @invoiceable, :invoice], class: 'btn'

%h3.bottom_margin.gray_ink
  -#Total: #{number_to_currency(@invoices.inject(0) {|total, i| total += i.amount})}

-#%p
-#  - if action_name == 'closed'
-#    = link_to 'Open invoices', [@invoiceable, Invoice]
-#  - else
-#    = link_to 'Closed invoices', [:closed, @invoiceable, Invoice]

.invoices
  %nav
    .nav.table_actions
      %ul.nav.nav-tabs
      = form_tag search_company_invoices_path, :class => 'simple_form', :method => "GET" do
        %span{style: "margin-left: 10px;"}
          Find:
        %input{type: "textfield", value: @find_text, name: "find", style: "width: 80px; margin-left: 5px;"}
        %span{style: "margin-left: 5px;"}
          Type:
        %select{name: "type", style: "width: 80px; margin-top: 8px;"}
          -if @type == "all"
            %option{value: "all", selected: "selected"}All
          -else
            %option{value: "all"}All
          -if @type == "opened"
            %option{value: "opened", selected: "selected"}Opened
          -else
            %option{value: "opened"}Opened
          -if @type == "closed"
            %option{value: "closed", selected: "selected"}Closed
          -else
            %option{value: "closed"}Closed
        .btn{style: "margin-left: 5px; margin-bottom: 5px;"}
          %input{type: "submit", value: "Submit", style: "border: none; background: none;"}
  = will_paginate @invoices, :renderer => 'BootstrapPaginationHelper::LinkRenderer'
  - if @invoices.size > 0
    %table.table.table-striped.one_action.invoices_table.tablesorter
      %thead
        %th ID / Xero Reference
        %th{class: "{sorter: 'currency'}"} Amount
        %th Customer
        %th Project
        %th Created
        %th Due
        %th Overdue
        %th Paid
      %tbody
        - for invoice in @invoices
          %tr
            %td.text_filter=link_to "##{invoice.reference}", [@invoiceable, invoice]
            %td=number_to_currency(invoice.amount, delimiter: '')
            %td.text_filter=link_to invoice.customer.name, invoice.customer
            %td
              -if invoice.project
                =link_to "#{invoice.project.name}", project_path(invoice.project)
              -else
                = 'N/A'
            %td=l invoice.date, format: :sortable
            %td=l invoice.due, format: :sortable
            %td= invoice.overdue? ? 'overdue' : ''
            %td
              -if invoice.paid?
                paid
              -elsif invoice.can_close?
                =link_to 'Pay', [:close, @invoiceable, invoice], confirm: "Has #{invoice.customer.name} made full payment?", method: :post, class: 'btn'


=content_for :javascripts do
  :coffeescript
    @search_filter = new Enspiral.Views.SimpleFilterSearch
      el: '.invoices'

    $('.tablesorter').tablesorter()
