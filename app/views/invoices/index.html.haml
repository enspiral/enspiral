- title("Invoices")
.row
  %h1.span5 #{@company.name} Invoices 
  .model_actions
    = link_to 'Add Invoice', new_company_invoice_path(@company), class: 'btn'



%h3.bottom_margin.gray_ink= "Total: #{number_to_currency(@invoices.inject(0) {|total, i| total += i.amount})}"

%p
  - if params[:action] == 'old'
    = link_to 'Current invoices', company_invoices_path(@company)
  - else
    = link_to 'Paid invoices', old_company_invoices_path(@company)

.invoices
  %nav
    .nav.table_actions
      %ul.nav.nav-tabs
        %li.nav_label
          Find: 
        .search_box.navbar-form.pull-left
          =text_field_tag :search, nil, :class => "input-small"
  - if @invoices.size > 0
    %table.table.table-striped.two_actions.invoices_table
      %thead
        %th
        %th 
          %i.icon-refresh
          Amount
        %th 
          %i.icon-refresh
          Customer
        %th 
          Date
      %tbody
        - for invoice in @invoices
          %tr
            %td.actions
              = link_to [@company, invoice] do
                %i.icon-pencil
              -unless controller.action_name == 'old'
                = link_to pay_company_invoice_path(@company, invoice), method: :post, class: 'green_ink', confirm: "#{invoice.customer.name} has paid #{invoice.amount}?" do
                  %i.icon-download-alt
            %td
              %span{class: "#{controller.action_name == 'old' ? 'green_ink' : 'red_ink'}"}= "$#{invoice.amount}"
            %td.text_filter
              =invoice.customer.name
            %td
              =nice_date invoice.date

=content_for :javascripts do
  :coffeescript
    @search_filter = new Enspiral.Views.SimpleFilterSearch(
      el: '.invoices'
    )
    $('.invoices_table').tablesorter()
