- title("View Invoice")

.row
  %h1.span5.bottom_margin Invoice to #{@invoice.customer.name}
  .model_actions
    =link_to 'Edit', edit_company_invoice_path(@company, @invoice), :class =>'btn'
    - unless @invoice.paid
      - if @invoice.allocated?
        = link_to 'Pay', pay_company_invoice_path(@company, @invoice), method: :post, class: 'btn btn-success'
      - else
        = button_to "Destroy", [@company, @invoice], :confirm => "Are you sure?", :method => :delete, class: 'btn'

.stats.bottom_margin
  %span
    %strong For:
    #{number_to_currency(@invoice.amount)}
  %span
    %strong Created:
    #{time_ago_in_words(@invoice.date)} ago
  %span
    %strong Due:
    #{time_ago_in_words(@invoice.due)} from now

  %span
    %strong Amount Received:
    =@invoice.total_payments

  %span
    %strong Amount Disbused:
    =@invoice.total_disbursed

%h3 Pending Allocations
%table.table
  %thead
    %tr
      %th Account
      %th Gross Amount
      %th Comission
      %th Disburse
  %tbody
    -@invoice.pending_allocations.each do |a|
      %tr
        %td=a.account.name
        %td=number_to_currency(a.amount)
        %td=a.commission
        %td=link_to('Disbuse', '#')

%h3 Disbursed Allocations
%table.table
  %thead
    %tr
      %th Account
      %th Gross Amount
      %th Comission
  %tbody
    -@invoice.allocations.disbursed.each do |a|
      %tr
        %td=a.account.name
        %td=number_to_currency(a.amount)
        %td=a.commission

%h3 Payments
%table.table.table-striped
  %thead
    %th Amount
    %th Paid on
  %tbody
    -@invoice.payments.order(:paid_on).each do |p|
      %tr
        %td=p.amount
        %td=p.paid_on

